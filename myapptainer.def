Bootstrap: docker
From: ubuntu:24.04

%post
    # apptainer build
    apt-get -y update
    apt-get install -y sudo
    apt-get -y upgrade

    apt-get install -y tzdata
    ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime
    dpkg-reconfigure -f noninteractive tzdata

    apt-get -y install \
        build-essential \
        cmake \
        git \
        python3 \
        python3-pip \
        python3-lark \
        clang \
        libtinfo-dev \
        zlib1g-dev \
        libncurses5-dev \
        libssl-dev \
        libxml2-dev \
        pkg-config \
        libffi-dev \
        libreadline-dev \
        curl \
        vim \
        wget \
        zip \
        unzip \
        ninja-build

    # yosys requirements
    apt-get -y install build-essential clang lld bison flex \
        libreadline-dev gawk tcl-dev libffi-dev git \
        graphviz xdot pkg-config python3 libboost-system-dev \
        libboost-python-dev libboost-filesystem-dev zlib1g-dev

%runscript
    # apptainer run
    echo "Apptainer for Bit-Serial Compiler Project"

%test
    # apptainer test
    [ -x /usr/bin/cmake ] && echo "CMake is installed" || exit 1
    [ -x /usr/bin/git ] && echo "Git is installed" || exit 1
    [ -x /usr/bin/clang ] && echo "Clang is installed" || exit 1

